{% extends 'base.html' %}

{% block title %}Catalogo{% endblock %} 

{% block content %}

<section class="catalogo-main">
    <div class="catalogo-grid">
        {% for p in productos %}
        <div class="catalogo-card-wrap">
            <article class="catalogo-card">
                <figure class="catalogo-img-box">
                    <a href="#" class="catalogo-img-link" onclick="openModal('modal{{ p.idProducto }}'); return false;">
                        {% if p.imagen %}
                            <img class="catalogo-img" loading="lazy" src="{{ url_for('static', filename='uploads/' + p.imagen) }}" alt="{{ p.nombre_producto }}">
                        {% else %}
                            <img class="catalogo-img" loading="lazy" src="{{ url_for('static', filename='img/placeholder.png') }}" alt="Sin imagen">
                        {% endif %}
                    </a>
                </figure>
                <div class="catalogo-info">
                    <h5 class="catalogo-title">
                        <a href="#" onclick="openModal('modal{{ p.idProducto }}'); return false;" style="color:inherit;text-decoration:none;">
                            {{ p.nombre_producto }}
                        </a>
                    </h5>
                    <p class="catalogo-desc">{{ p.descripcion }}</p>
                    <p class="catalogo-precio">
                        <span style="font-size:1.3em;color:#28a745;font-weight:bold;">${{ "{:,.0f}".format(p.precio) }}</span>
                    </p>
                    <form action="{{ url_for('agregarCarrito', id=p.idProducto) }}" method="POST" class="catalogo-form">
                        <div class="catalogo-form-row">
                            <input type="number" name="cantidad" min="1" value="1" max="{{p.cantidad}}" class="catalogo-input-cant" {% if p.cantidad == 0 %} disabled {% endif %}>
                            {% if p.cantidad == 0 %}
                                <span class="catalogo-agotado">Agotado</span>
                            {% else %}
                                <span class="catalogo-disponible">Stock: {{ p.cantidad }}</span>
                            {% endif %}
                        </div>
                        <button type="submit" class="catalogo-btn" {% if p.cantidad == 0 %} disabled {% endif %}>
                            <span>Agregar al Carrito</span>
                        </button>
                    </form>
                </div>
            </article>
        </div>
        {% endfor %}
    </div>
</section>
{% for p in productos %}
<!-- Modal -->
<div class="catalogo-modal" id="modal{{ p.idProducto }}" style="display:none;">
    <div class="catalogo-modal-backdrop" onclick="closeModal('modal{{ p.idProducto }}')"></div>
    <div class="catalogo-modal-content" role="dialog" aria-describedby="modalDesc{{ p.idProducto }}">
        <div class="catalogo-modal-header">
            <h4 class="catalogo-modal-title">{{p.nombre_producto}}</h4>
            <button type="button" class="catalogo-modal-close" onclick="closeModal('modal{{ p.idProducto }}')">&times;</button>
        </div>
        <div class="catalogo-modal-body">
            {% if p.imagen %}
                <img src="{{ url_for('static', filename='uploads/' + p.imagen) }}" alt="{{ p.nombre_producto }}" class="catalogo-modal-img">
            {% else %}
                <img src="{{ url_for('static', filename='img/placeholder.png') }}" alt="Sin imagen" class="catalogo-modal-img">
            {% endif %}
            <p id="modalDesc{{ p.idProducto }}" class="catalogo-modal-desc">{{ p.descripcion }}</p>
            <p class="catalogo-modal-precio">${{ "{:,.0f}".format(p.precio) }}</p>
            <form action="{{ url_for('agregarCarrito', id=p.idProducto) }}" method="POST" class="catalogo-modal-form">
                <input type="hidden" name="idPrecio" value="{{ p.idProducto }}">
                <div class="catalogo-form-row">
                    <input type="number" name="cantidad" min="1" value="1" max="{{p.cantidad}}" class="catalogo-input-cant" {% if p.cantidad == 0 %} disabled {% endif %}>
                    {% if p.cantidad == 0 %}
                        <span class="catalogo-agotado">Agotado</span>
                    {% else %}
                        <span class="catalogo-disponible">Stock: {{ p.cantidad }}</span>
                    {% endif %}
                </div>
                <button type="submit" class="catalogo-btn" {% if p.cantidad == 0 %} disabled {% endif %}>
                    <span>Agregar al Carrito</span>
                </button>
            </form>
        </div>
        <div class="catalogo-modal-footer">
            <button type="button" class="catalogo-btn catalogo-modal-close-btn" onclick="closeModal('modal{{ p.idProducto }}')">Cerrar</button>
        </div>
    </div>
</div>
{% endfor %}

{% endblock %}